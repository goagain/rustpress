use rustpress_sdk::export;

struct PoetryPlugin;

impl rustpress_sdk::Guest for PoetryPlugin {
    fn on_post_published(post: rustpress_sdk::PostData) -> Result<rustpress_sdk::PostData, String> {
        info!("Processing post for poetry enhancement");

        post.title.hash();
        let hash = post.title.hash();
        let line_index = hash % SONNET_LINES.len();
        let poetry_line = SONNET_LINES[line_index];
        let new_content = format!("> *{}*\n\n{}", poetry_line, post.content);
        post.content = new_content;

        Ok(post)
    }
}
// Static sonnet lines
static SONNET_LINES: &[&str] = &[
    "Shall I compare thee to a summer's day?",
    "Thou art more lovely and more temperate:",
    "Rough winds do shake the darling buds of May,",
    "And summer's lease hath all too short a date;",
    "Sometimes too hot the eye of heaven shines,",
    "And often is his gold complexion dimmed;",
    "And every fair from fair sometime declines,",
    "By chance or nature's changing course untrimmed;",
    "But thy eternal summer shall not fade,",
    "Nor lose possession of that fair thou ow'st;",
    "Nor shall death brag thou wander'st in his shade,",
    "When in eternal lines to time thou grow'st:",
    "So long as men can breathe or eyes can see,",
    "So long lives this, and this gives life to thee.",
];

rustpress_sdk::export!(PoetryPlugin);
